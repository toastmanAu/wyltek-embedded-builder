# HX711 — Load Cell / Weight Scale
**Driver:** `WyHX711.h`

---

## What it does
Reads a load cell (strain gauge) through the HX711 24-bit ADC chip. Load cells output a tiny analog signal proportional to the weight applied. The HX711 amplifies it and converts it to a digital value you can read over two GPIO pins.

## Common uses
- Kitchen scales, postal scales, luggage weighers
- Industrial weighing (hoppers, conveyors)
- Liquid level by weight (tank weighing instead of a level sensor)
- Force measurement, compression testing

## The load cell colours

Most load cells use a standard colour code:

| Wire colour | Connection |
|------------|-----------|
| Red | E+ (excitation positive) |
| Black | E- (excitation negative) |
| White | A- (signal negative) |
| Green | A+ (signal positive) |
| (yellow) | Shield (connect to GND) |

## Wiring (HX711 module)

| HX711 Pin | Connects to |
|-----------|------------|
| E+ | Load cell Red |
| E- | Load cell Black |
| A- | Load cell White |
| A+ | Load cell Green |
| VCC | 5V (or 3.3V — check module) |
| GND | GND |
| DOUT | ESP32 GPIO (data out) |
| CLK | ESP32 GPIO (clock) |

Most HX711 breakout boards run at 5V. The DOUT pin is typically 3.3V-compatible with a 5V supply, but verify this for your specific module.

## Specs

| Parameter | Value |
|-----------|-------|
| ADC resolution | 24-bit |
| Gain (Channel A) | 128 (40mV full scale) or 64 (20mV full scale) |
| Gain (Channel B) | 32 (80mV full scale) |
| Sample rate | 10Hz or 80Hz (set by RATE pin on chip) |
| Interface | 2-wire GPIO (not SPI) |

## Code Example

```cpp
#include <WySensors.h>
#include <sensors/drivers/WyHX711.h>

WySensors sensors;
WyHX711* scale;

void setup() {
    // pin = DOUT, pin2 = CLK
    scale = sensors.addGPIO<WyHX711>("weight", 4, 5);
    sensors.begin();

    // Zero the scale with nothing on it
    scale->tare();

    // Place a known weight (e.g. 500g) and read raw:
    // WySensorData d = sensors.read("weight");
    // scale->setCalib(500.0 / d.raw);
    scale->setCalib(420.3);  // grams per raw unit — from calibration
}

void loop() {
    if (scale->isReady()) {
        WySensorData d = sensors.read("weight");
        if (d.ok) {
            Serial.printf("Weight: %.1f g\n", d.weight);
        }
    }
    delay(100);
}
```

## Calibration procedure

1. Call `scale->tare()` with nothing on the scale (zeros it out)
2. Place a known weight (e.g. exactly 500g)
3. Read the raw value: `scale->rawValue()`
4. Set calibration: `scale->setCalib(500.0 / rawValue)`

```cpp
// One-time calibration sketch:
scale->tare();
Serial.println("Place 500g weight and press enter...");
while (!Serial.available()) delay(100);
Serial.read();
int32_t raw = scale->rawValue();
float calib = 500.0f / raw;
Serial.printf("Calibration factor: %.4f\n", calib);
// Save to preferences and use setCalib() on boot
```

## WySensorData fields

| Field | Content |
|-------|---------|
| `weight` | Weight in grams (after tare and calibration) |
| `raw` | Raw 24-bit ADC value (float) |
| `ok` | `true` if reading succeeded |
| `error` | `"not ready"` if DOUT still HIGH |

## Gain channels

| Channel | Pulses | Full scale | Use |
|---------|--------|-----------|-----|
| A gain 128 | 25 | 40mV | Default — most common |
| A gain 64 | 27 | 20mV | Higher sensitivity |
| B gain 32 | 26 | 80mV | Second load cell |

```cpp
scale->setGain(HX711_GAIN_A128);  // default
scale->setGain(HX711_GAIN_B32);   // channel B
```

## Gotchas

**DOUT never goes LOW.** If `begin()` hangs or returns `false`, DOUT never went LOW within 1 second. This means the HX711 has no power, or the DOUT/CLK pins are swapped. The driver prints `[HX711] DOUT never went LOW — check wiring` to Serial.

**CLK must be pin2.** Register the sensor with `addGPIO<WyHX711>("scale", DOUT_PIN, CLK_PIN)`. `pin` = DOUT, `pin2` = CLK. Swapping them won't work.

**Noise on reads.** The HX711 reads 24 bits using `noInterrupts()` — this briefly disables interrupts during the read. Keep this in mind if you're running WiFi, which uses interrupts extensively.

**400ms settle time on powerOn.** After `powerOn()` the driver waits 400ms for the HX711 to settle. `begin()` calls `powerOn()`. Your setup will pause here.

**Sample rate: 10Hz or 80Hz.** Many HX711 modules have the RATE pin tied to GND (10Hz). For 80Hz, you need a module with RATE accessible or to jumper it to VCC. The driver doesn't control this pin.

**Temperature drift.** Load cells change sensitivity slightly with temperature. For precision applications, either temperature-compensate or let the load cell warm up before calibrating.

**Power down between reads.** For battery-powered applications, call `scale->powerDown()` between reads to reduce current. The HX711 draws ~1.5mA when active.

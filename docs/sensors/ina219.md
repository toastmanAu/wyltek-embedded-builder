# INA219 — Voltage, Current & Power Monitor
**Driver:** `WyINA219.h`

---

## What it does
Measures the voltage, current, and power of a DC circuit. You put it in series with your load — the sensor has a small shunt resistor (usually 0.1Ω on breakout boards) and measures the tiny voltage drop across it to calculate current. Then multiplies by bus voltage to get power.

## What you can measure
- Bus voltage: 0–26V (the load's supply voltage)
- Current: up to 3.2A with default 0.1Ω shunt (up to 32A with smaller shunt)
- Power: calculated as bus voltage × current (in Watts)
- Shunt voltage: raw mV drop across the resistor (for debugging)

## Wiring

The INA219 sits **in series** with your power supply line:

```
Power supply (+) ── INA219 VIN+ ── INA219 VIN- ── Load (+)
Power supply (-)                                  Load (-)
```

The I2C connection for the ESP32:

| INA219 Pin | ESP32 |
|-----------|-------|
| VCC | 3.3V |
| GND | GND |
| SDA | GPIO (any I2C SDA) |
| SCL | GPIO (any I2C SCL) |
| A0 | See address table |
| A1 | See address table |

## I2C Addresses

| A0 | A1 | Address |
|----|----|----|
| GND | GND | `0x40` (default) |
| VCC | GND | `0x41` |
| GND | VCC | `0x44` |
| VCC | VCC | `0x45` |

You can have up to 4 INA219s on one I2C bus.

## Specs

| Parameter | Value |
|-----------|-------|
| Bus voltage range | 0–26V |
| Shunt voltage range | ±320mV (default config) |
| Current with 0.1Ω shunt | up to 3.2A |
| Resolution (voltage) | 4mV |
| Resolution (current) | ~0.1mA with 0.1Ω shunt |
| Interface | I2C, 400kHz |
| I2C address | 0x40–0x45 |

## Code Example

```cpp
#include <WySensors.h>

WySensors sensors;

void setup() {
    sensors.addI2C<WyINA219>("power", 21, 22, 0x40);
    sensors.begin();
}

void loop() {
    WySensorData d = sensors.read("power");
    if (d.ok) {
        float watts = d.voltage * d.current;
        Serial.printf("%.2fV  %.3fA  %.3fW\n",
            d.voltage, d.current, watts);
    }
    delay(500);
}
```

## WySensorData fields

| Field | Content |
|-------|---------|
| `voltage` | Bus voltage in Volts |
| `current` | Current in Amperes |
| `weight` | Power in Watts (bus voltage × current) |
| `raw` | Shunt voltage in millivolts |
| `ok` | `true` if read succeeded |
| `error` | `"overflow"` if bus voltage overflowed |

Note: `weight` is repurposed for power (Watts) since there's no dedicated power field in `WySensorData`.

## Customising the shunt resistor

If your breakout board has a different shunt resistor, pass it at construction:

```cpp
// 0.05Ω shunt = up to 6.4A measurement range
sensors.addI2C<WyINA219>("high_current", 21, 22, 0x40, 0.05f);
```

Or set the build flag: `-DWY_INA219_SHUNT_OHM=0.05`

## Gotchas

**The INA219 measures the low side by default.** Standard breakout boards are typically wired for low-side sensing (shunt between load and GND). High-side sensing (shunt between supply and load) requires flipping the connection. The driver works either way — just swap VIN+ and VIN-.

**`begin()` verifies by reading back the config register.** If it returns `false`, the config register readback didn't match. This almost always means the sensor isn't connected or the address is wrong.

**Overflow flag.** If `d.error = "overflow"`, the bus voltage exceeded the 32V limit (or the measurement arithmetic overflowed). Check your circuit isn't exceeding the sensor's range.

**Calibration register.** The driver uses the calibration register for the internal current register. It sets current LSB = 3.2A / 32768 = ~0.1mA. For very low current applications (µA range), you'd want a different configuration — not currently exposed in the driver.

**The 0.1Ω shunt dissipates heat.** At 3A the shunt drops 300mV and dissipates 0.9W. Most breakout board shunts are rated for 2–3W. At sustained high current, the board will get warm — this is normal but watch for thermal issues.

**Monitor a LiPo battery pack.** Put the INA219 between your charger's output and the battery, or between battery and load, to measure charge/discharge current and track capacity over time.

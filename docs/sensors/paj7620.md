# PAJ7620U2 Gesture Sensor
**Driver:** `WyPAJ7620.h`

---

## What it does
Detects 9 hand gestures in mid-air using an internal 8×8 IR image array with onboard DSP. No raw image data — just gesture results. Works in complete darkness.

| Gesture | Code | Description |
|---------|------|-------------|
| Right | 0x01 | Swipe hand right |
| Left | 0x02 | Swipe hand left |
| Up | 0x04 | Swipe hand upward |
| Down | 0x08 | Swipe hand downward |
| Forward | 0x10 | Push hand toward sensor |
| Backward | 0x20 | Pull hand away from sensor |
| Clockwise | 0x40 | Circular motion, clockwise |
| Anti-clockwise | 0x80 | Circular motion, counter-clockwise |
| Wave | 0x01* | Fast left-right oscillation |

*Wave comes from INT_FLAG_2, not INT_FLAG_1.

## Wiring
| PAJ7620 pin | ESP32 |
|-------------|-------|
| VCC | **3.3V only** (not 5V) |
| GND | GND |
| SDA | I2C SDA |
| SCL | I2C SCL |
| INT | GPIO (optional but recommended) |

**4.7kΩ pull-ups required on SDA and SCL.**

## ⚠️ 3.3V only
The PAJ7620U2 is a 3.3V device. 5V will damage it. Most breakout boards do NOT have a regulator — check before powering.

## The magic init sequence
The chip requires ~70 register writes from PixArt's application note to configure the internal DSP. These are undocumented values — every working implementation has the same table. The driver handles this automatically in `begin()`. **Do not skip or modify the init sequence.**

## Bank switching
The PAJ7620 has two register banks:
- **BANK0** — gesture results, normal operation
- **BANK1** — configuration (init sequence only)

Switch by writing register `0xEF`: `0x00` = BANK0, `0x01` = BANK1. The driver tracks the current bank and only switches when needed.

## Getting reliable gestures — the key tips

### 1. Use the INT pin
Without INT, you poll and occasionally catch mid-gesture states. With INT wired, the chip only signals when a **complete confirmed gesture** is ready. Makes a huge difference in reliability.

```cpp
auto* gesture = sensors.addI2C<WyPAJ7620>("gesture", SDA, SCL, 0x73);
gesture->setIntPin(4);  // INT → GPIO 4
```

### 2. Distance matters — 5–15cm sweet spot
- Too close (<5cm): sensor saturates, misreads
- Too far (>20cm): insufficient IR reflection, misses gestures
- Sweet spot: **8–12cm** from sensor face

### 3. Move deliberately
- Gesture duration: **0.1–0.5 seconds** for best detection
- Too fast: sensor misses it
- Too slow: classified as proximity, not gesture
- Practice makes it feel natural quickly

### 4. Clear the flags every read
The INT_FLAG registers **latch**. If you don't clear them after reading, the next read returns the same gesture forever. The driver clears flags immediately after every read — even if no gesture was detected. If you ever poll manually, always read both flag registers.

### 5. 100kHz I2C only
The chip technically supports 400kHz but is unreliable at that speed, especially on shared buses or with longer wires. The driver locks to 100kHz. Don't override this.

### 6. Avoid direct sunlight
The internal IR LEDs compete with ambient IR. In bright sunlight, false triggers and missed gestures are common. Works perfectly in indoor lighting and complete darkness.

### 7. Add a 10µF cap on VCC
The LED pulses draw burst current. A 10µF electrolytic cap on the VCC rail near the sensor prevents voltage sag from causing I2C glitches.

## The wave gesture
Wave is detected separately in INT_FLAG_2 bit 0 — it's a fast oscillating left-right motion, distinct from individual Left/Right swipes. The driver checks both registers automatically.

## Proximity mode
The same sensor can do basic proximity detection — how bright is the nearest object's IR reflection. Useful for "hand approaching" triggers before gesture detection.

```cpp
uint8_t prox = gesture->proximity();  // 0=nothing, 255=very close
```

## Multiple gesture in one read
Occasionally both UP and another gesture fire in the same frame (sensor caught motion in two axes). The driver picks the highest-priority bit. If you want raw flags:
```cpp
auto* paj = sensors.get<WyPAJ7620>("gesture");
// Read directly via gesture code
```

## Example
```cpp
auto* paj = sensors.addI2C<WyPAJ7620>("gestures", 21, 22, 0x73);
sensors.begin();

void loop() {
    WySensorData d = sensors.read("gestures");
    if (d.ok) {
        Serial.printf("Gesture: %s\n", paj->gestureName());
        switch (d.rawInt) {
            case WY_GESTURE_UP:    brightnessUp(); break;
            case WY_GESTURE_DOWN:  brightnessDown(); break;
            case WY_GESTURE_LEFT:  prevTrack(); break;
            case WY_GESTURE_RIGHT: nextTrack(); break;
            case WY_GESTURE_WAVE:  toggleMute(); break;
        }
    }
}
```
